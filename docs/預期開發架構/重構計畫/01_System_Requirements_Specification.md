# OpenCode Agent 平台 - 系統需求規格 (SRS)

**文件版本:** 1.0
**日期:** 2026-01-22
**專案:** OpenCode 通用代理平台
**作者:** 系統架構團隊

---

## 1. 執行摘要

### 1.1 專案概覽
將 OpenCode 轉型為一個通用的 AI 代理平台，結合情境管理的簡易性與多步驟協同運作的強大功能，為編碼任務和通用代理工作流程提供**單一入口**。

### 1.2 策略目標
- **統一體驗**: 相同的規則/技能適用於編程和一般任務
- **性能優化**: 簡單任務採快速路徑，複雜工作流程採代理路徑
- **企業就緒**: 權限控制、工具沙箱、審計追蹤
- **模組化架構**: 清晰的介面以實現長期可維護性

---

## 2. 利益關係人需求

### 2.1 主要使用者
- **開發者**: 需要在保留現有工作流程的情況下獲得編碼輔助
- **進階使用者**: 需要通用任務自動化
- **企業團隊**: 要求治理、安全性和可審計性

### 2.2 使用者故事

#### US-001: 開發者工作流程連續性
```
作為一名使用 Claude Code 工作流程的開發者，
我希望在遷移到 OpenCode 時不會失去我的 CLAUDE.md 規則和技能，
以便在獲得新功能的同時保持我的生產力。
```

#### US-002: 任務智慧路由
```
作為一名處理混合工作負載的使用者，
我希望簡單的任務能立即執行，沒有規劃開銷，
這樣我就不必為基本操作支付代理的複雜性成本。
```

#### US-003: 企業治理
```
作為一名企業管理員，
我需要精細的權限控制和審計追蹤，
以便在受監管的環境中安全地部署 AI 代理。
```

---

## 3. 功能需求

### 3.1 核心能力

#### FR-001: 情境管理與規則系統
- **需求**: 支援 CLAUDE.md/AGENTS.md 規則注入，具備遞迴繼承功能
- **驗收標準**:
  - 從儲存庫層級結構（專案 → 上層 → 全域）載入規則
  - 支援 OpenCode 和 Claude Code 規則格式
  - 無需重啟即可即時更新規則

#### FR-002: 技能庫管理
- **需求**: 與 .claude/skills/ 慣例相容的統一技能系統
- **驗收標準**:
  - 從 `.claude/skills/` 和 `.opencode/skills/` 自動發現技能
  - 手動和自動技能調用
  - 用於技能管理的版本控制整合

#### FR-003: 智慧任務路由
- **需求**: 根據複雜性將任務路由到適當的執行路徑
- **驗收標準**:
  ```
  快速路徑（直接執行）:
  - 檔案操作（讀取、編輯、建立）
  - 單一工具操作
  - 簡單的問答

  代理路徑（協同運作）:
  - 多系統整合
  - 需要多步驟規劃
  - 複雜的決策鏈
  - 長情境綜合
  ```

#### FR-004: 子代理協同運作
- **需求**: 支援具有角色專業化的分層代理委派
- **驗收標準**:
  - 規劃者、執行者、審核者、路由器代理
  - 基於權限的代理調用控制
  - 跨代理交接的狀態管理

#### FR-005: MCP 工具整合
- **需求**: 所有外部能力均透過 MCP 協定公開
- **驗收標準**:
  - 支援本地和遠端 MCP 伺服器
  - 工具沙箱和資源限制
  - 企業系統整合（資料庫、CI/CD、JIRA）

### 3.2 安全與治理

#### FR-006: 權限系統
- **需求**: 具有允許/詢問/拒絕策略的精細存取控制
- **驗收標準**:
  - 具有萬用字元支援的工具級權限
  - 針對模糊情況的執行時權限提示
  - 所有權限決策的審計日誌

#### FR-007: 工具執行掛鉤
- **需求**: 用於策略執行的前/後執行掛鉤
- **驗收標準**:
  - tool.execute.before: 策略驗證、敏感資料遮罩
  - tool.execute.after: 審計日誌、結果摘要
  - 用於自訂治理規則的外掛系統

---

## 4. 非功能性需求

### 4.1 性能需求
- **NFR-001**: 快速路徑操作在 <2 秒內完成
- **NFR-002**: 代理路徑路由決策在 <1 秒內完成
- **NFR-003**: 在安全的情況下支援並發工具執行

### 4.2 可擴展性需求
- **NFR-004**: 處理高達 100MB 的儲存庫並保持響應性能
- **NFR-005**: 支援最多 10 個並發 MCP 連線
- **NFR-006**: 核心平台記憶體佔用保持在 <500MB

### 4.3 可靠性需求
- **NFR-007**: 核心情境管理 99.9% 的正常執行時間
- **NFR-008**: 當 MCP 伺服器不可用時的優雅降級
- **NFR-009**: 從失敗的代理操作中自動恢復

### 4.4 可維護性需求
- **NFR-010**: OpenCode 核心與協同運作層之間的明確分離
- **NFR-011**: 所有配置均可版本控制（Git 友好）
- **NFR-012**: 用於自訂功能而無需修改核心的外掛系統

---

## 5. 系統限制

### 5.1 技術限制
- **CON-001**: 必須保持與現有 OpenCode 配置的向後相容性
- **CON-002**: 所有工具整合均需符合 MCP 協定
- **CON-003**: 基於檔案的配置（無資料庫依賴）

### 5.2 業務限制
- **CON-004**: 保留現有的 OpenCode 授權模式
- **CON-005**: 維持開源開發方法
- **CON-006**: 支援從現有 Claude Code 工作流程逐步遷移

---

## 6. 介面需求

### 6.1 使用者介面
- **UI-001**: 保留現有的 OpenCode TUI/CLI 介面
- **UI-002**: 明確指示快速路徑與代理路徑的執行
- **UI-003**: 用於互動式決策的權限提示介面

### 6.2 系統介面
- **SI-001**: 所有工具通訊均使用 MCP 協定
- **SI-002**: 用於協同運作服務的 REST API（可選）
- **SI-003**: 用於規則/技能管理的檔案系統 API

### 6.3 整合需求
- **IN-001**: Claude Code 遷移工具
- **IN-002**: 企業 SSO 整合能力
- **IN-003**: 用於 SIEM 整合的標準日誌格式

---

## 7. 品質屬性

### 7.1 易用性
- 現有 Claude Code 使用者可以以最小的學習曲線進行遷移
- 對於執行路徑選擇有明確的回饋
- 直觀的權限管理

### 7.2 安全性
- 工具存取的最小權限原則
- 全面的審計追蹤
- 安全處理敏感資訊

### 7.3 靈活性
- 可插拔的協同運作策略
- 可配置的路由規則
- 可擴展的 MCP 工具生態系統

---

## 8. 驗收標準

### 8.1 最小可行產品 (MVP)
- [ ] 基本操作的快速路徑執行
- [ ] 複雜多步驟任務的代理路徑
- [ ] CLAUDE.md 規則相容性
- [ ] 基本的 MCP 工具整合
- [ ] 具有審計日誌的權限系統

### 8.2 成功指標
- **遷移成功**: 90% 的現有 Claude Code 工作流程無需修改即可運作
- **性能**: 快速路徑操作比完整的代理執行快 5 倍
- **採用率**: 企業試點專案中 80% 的使用者滿意度

---

## 9. 依賴與假設

### 9.1 外部依賴
- OpenCode 平台（目前穩定版本）
- MCP 協定規格
- 企業認證系統（用於企業部署）

### 9.2 假設
- 使用者對基於檔案的配置有現有熟悉度
- 企業環境支援 MCP 協定
- 工具提供商採用 MCP 介面標準

---

## 10. 附錄

### 附錄 A: 詞彙表
- **快速路徑**: 無需代理規劃的直接工具執行
- **代理路徑**: 具有規劃的多步驟協同運作執行
- **MCP**: 用於工具整合的模型情境協定
- **協同運作者**: 負責代理工作流程管理的服務

### 附錄 B: 參考資料
- [OpenCode 文件](https://opencode.ai/docs/)
- [Claude Code 文件](https://docs.anthropic.com/en/docs/claude-code/)
- [MCP 協定規格](https://modelcontextprotocol.io/)

---

**文件控制:**
- 需審核: 系統架構團隊
- 需批准: 技術負責人、產品負責人
- 下次審核日期: 2026-02-15
